generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Portfolio {
  code  String  @id @db.VarChar(32)
  name  String  @db.VarChar(128)
  trade Trade[] @relation("portfolioTotrade")

  @@map("portfolio")
}

model Security {
  code       String  @id @db.VarChar(16)
  shortName  String  @map("short_name") @db.VarChar(16)
  fullName   String  @map("full_name") @db.VarChar(128)
  boardId    String  @map("board_id") @db.VarChar(32)
  market     String  @db.VarChar(32)
  engine     String  @db.VarChar(32)
  currencyId String  @map("currency_id") @db.VarChar(8)
  type       String  @db.VarChar(32)
  group      String  @db.VarChar(16)
  bond       Bond?
  trade      Trade[] @relation("securityTotrade")

  @@map("security")
}

model Bond {
  securityCode    String   @id @map("security_code") @db.VarChar(16)
  bondType        String?  @map("bond_type") @db.VarChar(64)
  faceValue       Decimal  @map("face_value") @db.Decimal(12, 4)
  accruedInterest Decimal  @map("accrued_interest") @db.Decimal(12, 4)
  matDate         DateTime @map("mat_date") @db.Date
  bondization     Decimal  @db.Decimal(12, 4)
  security        Security @relation(fields: [securityCode], references: [code], onDelete: NoAction, onUpdate: NoAction, map: "security_code")

  @@index([matDate], map: "mat_date_index")
  @@map("bond")
}

model Trade {
  id              Int       @id @default(autoincrement())
  portfolioCode   String    @map("portfolio_code") @db.VarChar(32)
  type            String    @db.VarChar(16)
  count           Int
  price           Decimal   @db.Decimal(12, 4)
  total           Decimal   @db.Decimal(12, 4)
  tradeDate       DateTime  @map("trade_date") @db.Timestamp(6)
  securityCode    String    @map("security_code") @db.VarChar(16)
  countMultiplier Decimal   @default(1) @map("count_multiplier") @db.Decimal(12, 4)
  portfolio       Portfolio @relation("portfolioTotrade", fields: [portfolioCode], references: [code], onDelete: NoAction, onUpdate: NoAction, map: "portfolio")
  security        Security  @relation("securityTotrade", fields: [securityCode], references: [code], onUpdate: Restrict, map: "security_code")

  @@index([portfolioCode], map: "portfolio_code_index")
  @@index([securityCode], map: "security_code_index")
  @@index([tradeDate], map: "trade_date_index")
  @@index([type], map: "type_index")
  @@map("trade")
}
